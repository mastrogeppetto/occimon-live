# Summary #
This repository contains all is needed to run a simple demo of the OCCI monitoring Extension. The demo does not contain the front-end of the API, the one across which the user inputs the description of the monitoriing framework, and assumes that the description has already been loaded. Instead, the demo contains the engine that, using the description, creates the monitoring framework.

The monitored system is composed of three virtual machines

* **server** is the the web server that delivers the framework description as HTTP response content,
* **sensor** manages the monitoring stream, 
* **pc1** is the target of the monitoring activity. 

The whole system is generated by Vagrant with a single "up" command.

The monitoring consists of the measurement of the CPU load on the resource: the results are filtered using a Exponentially Weighted Moving Average, and delivered to the guest machine as UDP datagrams on port 8888.

#HOWTO#

You need to have DropBox and Vagrant installed on the guest machine to run the demo. The first time you need also a fast Internet connection to download approx. 500Mb for a disk image (Vagrant box)

1. Clone this repository into an empty directory
2. Run

```
$ vagrant up
```
The system is generated and booted. The first time you run this command a disk image will be downloaded, so expect a significant delay.

3. Launch the metric container on **pc1**. Use the command "probe.sh" with the id of the monitored resource urn:uuid:c2222

```
me@mydesktop:~/demodir$ vagrant ssh pc1
...
vagrant@pc1:~$ ./probe.sh urn:uuid:c2222
Launch collector endpoint http://192.168.5.2:6789/urn:uuid:c2222
Metric container is ready (192.168.5.3:12312)
```
The metric container is now up and running, and waits for input from the sensor

4. Launch the sensor container on **sensor**. Use the command "sensor.sh" with the id of the sensor resource(s): urn:uuid:s1111

```
me@mydesktop:~/demodir$ vagrant ssh sensor
...
vagrant@sensor:~$ ./sensor.sh urn:uuid:s1111
Launching sensor urn:uuid:s1111
Sensor receiving from TCP socket 192.168.5.6:52812
Launching remote collectors: [urn:uuid:2345]
Sensor launching collector from 192.168.5.3:12312
Logging true to my/log/file
ewma input: 1.0
sendudp: sending 1.0
Logging true to my/log/file
ewma input: 1.0
sendudp: sending 1.0
...
```
The sensor description is loaded from the web server. The sensor thread opens an input socket and fetches from the server the description of the collector. Using this information it instructs the metric container on **pc1** to start its activity. Data is received, processed with the EWMA filter, and delivered as a stream of datagrams to the guest machine.

Now you can switch on the guest machine and observe the stream of UDP packets:
```
me@mydesktop:~/Desktop$ nc -ul 8888
Data: 2.3689306
Data: 2.2884052
Data: 2.2126167
Data: 2.1412864
...
```


* Version
* [Learn Markdown](https://bitbucket.org/tutorials/markdowndemo)

### How do I get set up? ###

* Summary of set up
* Configuration
* Dependencies
* Database configuration
* How to run tests
* Deployment instructions

### Contribution guidelines ###

* Writing tests
* Code review
* Other guidelines

### Who do I talk to? ###

* Repo owner or admin
* Other community or team contact